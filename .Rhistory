#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
gaps_row = c(5, 9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
ann_rows <- data.frame(row.names = rownames(CH4_res_mat),
#"Alli_sig" = CH4_res_meta$`AL_sig`,
#"DE_sig" = CH4_res_meta$`DE_sig`,
#"Wacc_sig" = CH4_res_meta$`WA_sig`,
#"SF_sig" = CH4_res_meta$`SF_sig`,
Prediction = CH4_res_meta$Prediction,
#Hypothesis = CH4_res_meta$Hypothesis,
Variable = CH4_res_meta$Variable.Type,
Type = CH4_res_meta$Type)
ann_colors <- list(Type = c(Flux = "#FFFF99",
Porewater = "#A6CEE3",
Sediment = "#B15928"),
Variable = c(Chemical = "#440154FF",
Microbial = "#FDE725FF"),
# Hypothesis = c(Methanogens = "#F8766D",
#                Methanotrophs = "#7CAE00",
#                `Alternate e-` = "#00BFC4",
#                Decomposition = "#C77CFF"),
Prediction = c(Positive = "red",
Negative = "blue"),
# "SF_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "DE_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "Alli_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "Wacc_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white")
)
ann_colors <- list(Type = c(Flux = "#FFFF99",
Porewater = "#A6CEE3",
Sediment = "#B15928"),
Variable = c(Chemical = "#440154FF",
Microbial = "#FDE725FF"),
# Hypothesis = c(Methanogens = "#F8766D",
#                Methanotrophs = "#7CAE00",
#                `Alternate e-` = "#00BFC4",
#                Decomposition = "#C77CFF"),
# "SF_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "DE_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "Alli_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
# "Wacc_sig" = c(`Pfdr < 0.05` = "black",
#            `Pfdr > 0.05` = "white"),
Prediction = c(Positive = "red",
Negative = "blue"))
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
gaps_row = c(5, 9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 10,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 15,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 5,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(CH4_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(CH4_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 22),
filename = "FinalFigs/Figure5.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
# Get all corrs
sf_cor <- multiple_correlations(env_nona = env_nona_sf, var = "Salinity_ppt_all") %>%
dplyr::select(Variable, rho, SpearmanPcut)
sf_corG <- meth_corr_by_taxonomy(input = sf, level = 9, threshold = 0, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
sf_corP <- meth_corr_by_taxonomy(input = sf, level = 2, threshold = 0.5, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
sf_corMGMT <- cor.test(sf$map_loaded$MG_MT, sf$map_loaded$Salinity_ppt_all, method = "spearman")
sf_res <- rbind(sf_cor, sf_corG, sf_corP) %>%
add_row("Variable" = "MG:MT", "rho" = round(sf_corMGMT$estimate, digits = 2), "SpearmanPcut" = "Pfdr > 0.05") %>%
rename(SF_rho = rho,
SF_sig = SpearmanPcut)
sf_res$Variable <- replace(sf_res$Variable, sf_res$Variable == "sed_pH" , "pH")
# Note, DE is just field, because no lab methane data yet
detra_cor <- multiple_correlations(env_nona = env_nona_detra, var = "Salinity_ppt_all") %>%
dplyr::select(Variable, rho, SpearmanPcut)
detra_corG <- meth_corr_by_taxonomy(input = detra, level = 9, threshold = 0, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
detra_corP <- meth_corr_by_taxonomy(input = detra, level = 2, threshold = 0.5, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
detra_corMGMT <- cor.test(detra$map_loaded$MG_MT, detra$map_loaded$Salinity_ppt_all, method = "spearman")
de_res <- rbind(detra_cor, detra_corG, detra_corP) %>%
add_row("Variable" = "MG:MT", "rho" = round(detra_corMGMT$estimate, digits = 2), "SpearmanPcut" = "Pfdr > 0.05") %>%
rename(DE_rho = rho,
DE_sig = SpearmanPcut)
nc_cor <- multiple_correlations(env_nona = env_nona_nc, var = "Salinity_ppt_all") %>%
dplyr::select(Variable, rho, SpearmanPcut)
nc_corG <- meth_corr_by_taxonomy(input = nc, level = 9, threshold = 0, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
nc_corP <- meth_corr_by_taxonomy(input = nc, level = 2, threshold = 0.5, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
nc_corMGMT <- cor.test(nc$map_loaded$MG_MT, nc$map_loaded$Salinity_ppt_all, method = "spearman")
nc_res <- rbind(nc_cor, nc_corG, nc_corP) %>%
add_row("Variable" = "MG:MT", "rho" = round(nc_corMGMT$estimate, digits = 2), "SpearmanPcut" = "Pfdr < 0.05") %>%
rename(AL_rho = rho,
AL_sig = SpearmanPcut)
sc_cor <- multiple_correlations(env_nona = env_nona_sc, var = "Salinity_ppt_all") %>%
dplyr::select(Variable, rho, SpearmanPcut)
sc_corG <- meth_corr_by_taxonomy(input = sc, level = 9, threshold = 0, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
sc_corP <- meth_corr_by_taxonomy(input = sc, level = 2, threshold = 0.5, data = "Yes") %>%
rename(Variable = Taxon) %>%
dplyr::select(Variable, rho, SpearmanPcut)
sc_corMGMT <- cor.test(sc$map_loaded$MG_MT, sc$map_loaded$Salinity_ppt_all, method = "spearman")
sc_res <- rbind(sc_cor, sc_corG, sc_corP) %>%
add_row("Variable" = "MG:MT", "rho" = round(sc_corMGMT$estimate, digits = 2), "SpearmanPcut" = "Pfdr > 0.05") %>%
rename(WA_rho = rho,
WA_sig = SpearmanPcut)
# Make df
# Prep. data frame
# Update, need to merge WA SRP_umol_m2_h and DE SR_umol_cm3_d as SR column
Sal_res <- data.frame("Variable" = c("CH4_H2", "CH4_ac", "CH4_me", "CH4_mix", "MG:MT",
"ANME", "MOB_I", "MOB_II", "MOB_IIa",
"Salinity_ppt_all", "NO3_mgL", "sed_NO3_mgL",
"N2O_ug_m2_h", "SRP_umol_m2_h", "SR_umol_cm3_d", "SO4_mgL",
"sed_SO4_mgL", "SRB", "Fe_mgL", "sed_Fe_mgL",
"FeRB", "Mn_mgL", "sed_Mn_mgL",
"CO2_ug_m2_h", "sed_per_org", "DOC_mgL",
"TOC_mgL", "sed_per_C", "sed_CN",
"sed_per_N", "DON_mgL", "DIN_mgL", "TN_mgL",
"NH4_mgL", "sed_NH4_mgL", "PO4_mgL", "sed_PO4_mgL",
"pH", "Firmicutes", "Actinobacteriota"),
"Shortname" = c("CH4_H2", "CH4_ac", "CH4_me", "CH4_mix", "MG:MT",
"ANME", "MOB_I", "MOB_II", "MOB_IIa",
"Salinity", "NO3", "NO3_s",
"N2O Flux", "SR", "SR", "SO4", "SO4_s", "SRB",
"Fe", "Fe_s", "FeRB", "Mn", "Mn_s",
"CO2 Flux", "SOM", "DOC", "TOC", "C", "C:N",
"N", "DON", "DIN", "TN", "NH4", "NH4_s", "PO4",
"PO4_s", "pH", "Firmicutes", "Actinobacteriota"),
"Type" = c("Sediment", "Sediment", "Sediment", "Sediment", "Sediment",
"Sediment", "Sediment", "Sediment", "Sediment",
"Porewater", "Porewater", "Sediment", "Flux",
"Sediment", "Sediment", "Porewater", "Sediment", "Sediment",
"Porewater", "Sediment", "Sediment", "Porewater",
"Sediment",
"Flux", "Sediment", "Porewater", "Porewater",
"Sediment", "Sediment", "Sediment", "Porewater",
"Porewater", "Porewater", "Porewater", "Sediment",
"Porewater", "Sediment", "Porewater", "Sediment", "Sediment"),
"Prediction" = c("Positive", "Positive", "Positive", "Positive", "Positive",
"Negative", "Negative", "Negative", "Negative",
"Negative", "Negative", "Negative", "Negative",
"Negative", "Negative", "Negative", "Negative", "Negative",
"Negative", "Negative", "Negative", "Negative",
"Negative",
"Positive", "Positive", "Positive", "Positive",
"Positive", "Negative", "Positive", "Positive",
"Positive", "Positive", "Positive", "Positive",
"Positive", "Positive", "Positive", "Positive", "Positive"),
"Variable Type" = c("Microbial", "Microbial", "Microbial", "Microbial", "Microbial",
"Microbial", "Microbial", "Microbial", "Microbial",
"Chemical", "Chemical", "Chemical", "Chemical",
"Microbial", "Microbial", "Chemical", "Chemical", "Microbial",
"Chemical", "Chemical", "Microbial", "Chemical",
"Chemical",
"Chemical", "Chemical", "Chemical", "Chemical",
"Chemical", "Chemical", "Chemical", "Chemical",
"Chemical", "Chemical", "Chemical", "Chemical",
"Chemical", "Chemical", "Chemical", "Microbial", "Microbial"),
"Hypothesis" = c("Methanogens", "Methanogens", "Methanogens", "Methanogens", "Methanogens",
"Methanotrophs", "Methanotrophs", "Methanotrophs", "Methanotrophs",
"Alternate e-", "Alternate e-", "Alternate e-", "Alternate e-",
"Alternate e-", "Alternate e-", "Alternate e-", "Alternate e-",
"Alternate e-", "Alternate e-", "Alternate e-", "Alternate e-",
"Alternate e-", "Alternate e-",
"Decomposition", "Decomposition", "Decomposition", "Decomposition",
"Decomposition", "Decomposition", "Decomposition", "Decomposition",
"Decomposition", "Decomposition", "Decomposition", "Decomposition",
"Decomposition", "Decomposition", "Decomposition", "Decomposition",
"Decomposition")) %>%
left_join(., sf_res, by = "Variable") %>%
left_join(., de_res, by = "Variable") %>%
left_join(., nc_res, by = "Variable") %>%
left_join(., sc_res, by = "Variable")
for (i in 1:nrow(Sal_res)) {
if(Sal_res$Variable[i] == "SRP_umol_m2_h") {
Sal_res$DE_rho[i] <- 0.79
}
if(Sal_res$Variable[i] == "SRP_umol_m2_h") {
Sal_res$DE_sig[i] <- "Pfdr > 0.05"
}
}
Sal_res <- subset(Sal_res, Variable != "SR_umol_cm3_d")
# Pretty heatmap
# Updated with reviewer feedback to remove hypothesis and significance columns
# Add significance asterisks instead
Sal_res_meta <- Sal_res %>%
dplyr::select(Shortname, Type, Variable.Type, Hypothesis, Prediction, SF_sig, WA_sig, DE_sig, AL_sig) %>%
mutate_if(is.character, as.factor)
Sal_res_mat <- Sal_res %>%
rownames_to_column(var = "Num") %>%
dplyr::select(-Num) %>%
column_to_rownames(var = "Shortname") %>%
dplyr::select(SF_rho, WA_rho, DE_rho, AL_rho) %>%
rename("Wacc_rho" = WA_rho,
"Alli_rho" = AL_rho) %>%
as.matrix()
ann_rows <- data.frame(row.names = rownames(Sal_res_mat),
#"Alli_sig" = Sal_res_meta$`AL_sig`,
#"DE_sig" = Sal_res_meta$`DE_sig`,
#"Wacc_sig" = Sal_res_meta$`WA_sig`,
#"SF_sig" = Sal_res_meta$`SF_sig`,
Prediction = Sal_res_meta$Prediction,
#Hypothesis = Sal_res_meta$Hypothesis,
Variable = Sal_res_meta$Variable.Type,
Type = Sal_res_meta$Type)
ann_colors <- list(Type = c(Flux = "#FFFF99",
Porewater = "#A6CEE3",
Sediment = "#B15928"),
Variable = c(Chemical = "#440154FF",
Microbial = "#FDE725FF"),
# Hypothesis = c(Methanogens = "#F8766D",
#                Methanotrophs = "#7CAE00",
#                `Alternate e-` = "#00BFC4",
#                Decomposition = "#C77CFF"),
# "SF_sig" = c(`Pfdr < 0.05` = "black",
#              `Pfdr > 0.05` = "white"),
# "DE_sig" = c(`Pfdr < 0.05` = "black",
#              `Pfdr > 0.05` = "white"),
# "Alli_sig" = c(`Pfdr < 0.05` = "black",
#                `Pfdr > 0.05` = "white"),
# "Wacc_sig" = c(`Pfdr < 0.05` = "black",
#                `Pfdr > 0.05` = "white"),
Prediction = c(Positive = "red",
Negative = "blue"))
pheatmap(Sal_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, max(na.omit(Sal_res_mat))),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 21),
filename = "FinalFigs/FigureS2.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
max(na.omit(Sal_res_mat))
pheatmap(Sal_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, 0.8),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 21),
filename = "FinalFigs/FigureS2.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(Sal_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, 0.85),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 21),
filename = "FinalFigs/FigureS2.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
pheatmap(Sal_res_mat,
legend = T,
legend_breaks = c(-0.5, 0, 0.5, 0.85),
legend_labels = c("-0.5", "0", "0.5", "rho\n"),
main = "",
#color = bluered(100),
#border_color = NA,
#na_col = "gray",
scale = "none",
angle_col = 315,
fontsize = 6,
fontsize_row = 9,
fontsize_col = 9,
annotation_row = ann_rows,
annotation_colors = ann_colors,
cluster_rows = F,
cluster_cols = F,
cellwidth = 20,
gaps_row = c(9, 22),
filename = "FinalFigs/FigureS2.png",
width = 4,
height = 7)
dev.off()
dev.set(dev.next())
dev.set(dev.next())
