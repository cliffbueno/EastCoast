#### Setup ####
library(plyr)
library(tidyverse)
library(readxl)
library(gplots)
library(scales)
library(magrittr)
library(DESeq2)
library(pheatmap)
library(vegan)
library(RColorBrewer)
`%notin%` <- Negate(`%in%`)
show_col(hue_pal()(3))
show_col(viridis_pal()(3))
hue_pal()(13)[1]
save_pheatmap_pdf <- function(x, filename, width = 7, height = 5) {
stopifnot(!missing(x))
stopifnot(!missing(filename))
pdf(filename, width=width, height=height)
grid::grid.newpage()
grid::grid.draw(x$gtable)
dev.off()
}
setwd("~/Desktop/Lab/HalomonasGenomes/")
# KO table - import 8 from BLAST Koala
I1_KO <- read.delim2("I1_ko.txt", header = F) %>%
select(-V1) %>%
filter(V2 != "") %>%
group_by(V2) %>%
summarise(MAG28 = n()) %>%
set_colnames(c("KO", "Halomonas. sp. D"))
I4_KO <- read.delim2("I4_ko.txt", header = F) %>%
select(-V1) %>%
filter(V2 != "") %>%
group_by(V2) %>%
summarise(MAG10 = n()) %>%
set_colnames(c("KO", "Halomonas. saccharevitans"))
# Merge into master table of 1s and 0s
KO_table <- full_join(I1_KO, I4_KO, by = "KO") %>%
column_to_rownames(var = "KO") %>%
mutate_if(is.character, as.integer)
KO_table[is.na(KO_table)] <- 0
KO_table[KO_table > 0] <- 1
KO_table <- KO_table %>%
rownames_to_column(var = "KO")
View(KO_table)
#### Methylphosphonate Degradation ####
# Note, all zeros in paths II and II so just show path I
a <- read_excel("~/Desktop/Marivita/MethylphosphonateKOs.xlsx", sheet = 1) %>%
mutate(Name = ifelse(is.na(Name), "", Name)) %>%
mutate(KO_def = paste(KEGG_KO, Name, sep = " ")) %>%
mutate_if(is.character, as.factor) %>%
arrange(Pathway_Order, Reaction_Order)
library(plyr) # Data manipulation
library(tidyverse) # Data manipulation
library(mctoolsr) # Microbial analyses
library(RColorBrewer) # Colors
library(vegan) # Multivariate analyses
library(indicspecies) # Indicator species
library(car) # Stats
library(FSA) # SE
library(magrittr) # Set names
library(PMCMRplus) # Stats
library(readxl) # Excel
library(writexl) # Excel
library(plotly) # Interactive plots
library(ggmap) # Maps
library(ggsn) # Maps
library(multcomp) # Tukey HSD and significance letters
library(emmeans) # Tukey HSD and significance letters
library(scales) # View colors
library(cowplot) # Multipanels
library(qvalue) # q values for indicator species
library(reshape2) # melt
library(gridExtra) # graphs
library(grid) # graphs
library(cowplot) # graphs
library(ggpubr) # graphs
library(ggExtra) # graphs
library(ggh4x) # graphs
library(dendextend) # graphs
library(corrplot) # correlation plots
library(pheatmap) # pretty heatmap
library(gplots) # color ramps
library(asbio) # Partial R2s
library(picante) # Trees
library(iCAMP) # NTI
library(lsr) # Cohen's d effect size
library(ape) # Phylogenetics
library(usmap) # Maps
# Functions
find_hull <- function(df) df[chull(df$Axis01, df$Axis02),]
`%notin%` <- Negate(`%in%`)
# Guild subsetting module from other repository
source("~/Documents/GitHub/SF_microbe_methane/modules/3_OTU_subsetting_modules_v.0.4_strip.r")
# Correlations
source("~/Documents/GitHub/EastCoast/meth_corr_by_taxonomy.R")
source("~/Documents/GitHub/EastCoast/meth_corr_by_bgc.R")
source("~/Documents/GitHub/EastCoast/multiple_correlations.R")
# Plotting
source("~/Documents/GitHub/EastCoast/cliffplot_taxa_bars.R")
source("~/Documents/GitHub/EastCoast/plot_venn_diagram2.R")
# Repository path
setwd("~/Documents/GitHub/EastCoast/")
# Wyatt Hartman's guild color palette
# Note that MeOB don't exist in this dataset, so removed
# But ANME do exist in this dataset, so add
# Extra methanogen guilds added so colors added too
Guild_cols <- read.table("~/Documents/GitHub/SF_microbe_methane/data/colors/Guild_color_palette.txt",
sep='\t') %>%
dplyr::select(Guild, G_index, color) %>%
set_names(c("Guild", "Index", "color")) %>%
mutate(Index = rev(Index)) %>%
add_row(Guild = "ANME", Index = 10, color = "#836FFF") %>%
add_row(Guild = "CH4_me", Index = 16, color = "#FDC086") %>%
add_row(Guild = "CH4_mix", Index = 17, color = "#FFFF99") %>%
filter(Guild != "MeOB") %>%
arrange(Index)
# Start here
nc <- readRDS("nc.rds")
disp <- betadisper(nc_bc, 1)
#### _Bray ####
nc_bc <- calc_dm(nc$data_loaded)
disp <- betadisper(nc_bc, 1)
disp <- betadisper(nc_bc, nc$map_loaded$Treatment)
#### _Bray ####
nc_bc <- calc_dm(nc$data_loaded)
set.seed(1150)
adonis2(nc_bc ~ nc$map_loaded$Treatment + nc$map_loaded$Depth) # Both sig
